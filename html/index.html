<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Page Tracker</title>
    <script>
      // Function to generate a unique user ID
      function generateUniqueId() {
        return "user-" + Math.random().toString(36).substr(2, 16);
      }

      // Function to get or set userId in localStorage
      function getUserId() {
        let userId = localStorage.getItem("userId");
        if (!userId) {
          userId = generateUniqueId();
          localStorage.setItem("userId", userId);
        }
        return userId;
      }

      // Function to detect device type
      function getDeviceType() {
        const ua = navigator.userAgent.toLowerCase();
        if (/tablet|ipad|playbook|silk/.test(ua)) {
          return "tablet";
        } else if (/mobi|android|phone|opera mini|fennec/.test(ua)) {
          return "phone";
        } else {
          return "desktop";
        }
      }

      // Function to get user's location via IP address
      async function getUserLocation() {
        try {
          const response = await fetch("https://ipapi.co/json/");
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error fetching location:", error);
          return {};
        }
      }

      // Function to track page view
      async function trackPageView() {
        const userId = getUserId();
        const page = window.location.pathname;
        const deviceType = getDeviceType();
        const location = await getUserLocation();

        const data = {
          userId: userId,
          page: page,
          deviceType: deviceType,
          location: location,
        };

        fetch("http://localhost:3000/trackPageView", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (response.ok) {
              console.log("Page view tracked successfully");
            } else {
              console.error("Error tracking page view:", response.statusText);
            }
          })
          .catch((error) => console.error("Error tracking page view:", error));
      }

      // Call trackPageView when the page is loaded
      document.addEventListener("DOMContentLoaded", trackPageView);
    </script>
  </head>
  <body>
    <h1>Welcome to the Page Tracker</h1>
    <p>This page tracks user visits and logs the data to the server.</p>
  </body>
</html>
